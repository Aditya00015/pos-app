[
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.089,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Source\",\n   \"column\": \"lead_source\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Source\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-27 08:10:57.840029",
  "limit": 500,
  "modified": "2024-05-22 16:36:49.713546",
  "name": "QRY-0003",
  "result_name": "ct9qbgmsdp",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.lead_source AS `Lead Source`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.lead_source\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Lead Source Visual Query",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.521,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Status\",\n   \"column\": \"status\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Status\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-27 08:10:56.525521",
  "limit": 500,
  "modified": "2024-05-22 08:16:46.911930",
  "name": "QRY-0002",
  "result_name": "ct9qo3a2ep",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.status AS `Status`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.status\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Status of Customer Visual Query",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.059,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Active Customers\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"left\": {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"status\",\n         \"table\": \"tabCustomer\"\n        }\n       },\n       \"operator\": \"=\",\n       \"right\": {\n        \"type\": \"String\",\n        \"value\": \"Active\"\n       },\n       \"type\": \"BinaryExpression\"\n      }\n     ],\n     \"function\": \"count_if\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"count_if(`tabCustomer.status` = 'Active')\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Active Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"left\": {\n       \"arguments\": [\n        {\n         \"left\": {\n          \"type\": \"Column\",\n          \"value\": {\n           \"column\": \"status\",\n           \"table\": \"tabCustomer\"\n          }\n         },\n         \"operator\": \"=\",\n         \"right\": {\n          \"type\": \"String\",\n          \"value\": \"Active\"\n         },\n         \"type\": \"BinaryExpression\"\n        }\n       ],\n       \"function\": \"count_if\",\n       \"type\": \"CallExpression\"\n      },\n      \"operator\": \"/\",\n      \"right\": {\n       \"arguments\": [\n        {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"name\",\n          \"table\": \"tabCustomer\"\n         }\n        }\n       ],\n       \"function\": \"count\",\n       \"type\": \"CallExpression\"\n      },\n      \"type\": \"BinaryExpression\"\n     },\n     \"operator\": \"*\",\n     \"right\": {\n      \"type\": \"Number\",\n      \"value\": 100\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"count_if(`tabCustomer.status` = 'Active')/count(`tabCustomer.name`)*100\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"New Customers\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"name\",\n         \"table\": \"tabCustomer\"\n        }\n       }\n      ],\n      \"function\": \"count\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"-\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"left\": {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"status\",\n          \"table\": \"tabCustomer\"\n         }\n        },\n        \"operator\": \"=\",\n        \"right\": {\n         \"type\": \"String\",\n         \"value\": \"Active\"\n        },\n        \"type\": \"BinaryExpression\"\n       }\n      ],\n      \"function\": \"count_if\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"count(`tabCustomer.name`)-count_if(`tabCustomer.status` = 'Active')\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"New Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-27 09:27:45.544973",
  "limit": 500,
  "modified": "2024-08-27 09:27:45.675503",
  "name": "QRY-0012",
  "result_name": "csltq46up7",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT count(*) AS `Total Customers`,\n       sum(CASE WHEN (`tabCustomer`.status = 'Active') THEN 1 ELSE 0 END) AS `Active Customers`,\n       (sum(CASE WHEN (`tabCustomer`.status = 'Active') THEN 1 ELSE 0 END) / count(*)) * 100 AS `Referral rate`,\n       count(*) - sum(CASE WHEN (`tabCustomer`.status = 'Active') THEN 1 ELSE 0 END) AS `New Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Referral Rate Visual Query",
  "transforms": [
   {
    "options": "{}",
    "parent": "QRY-0012",
    "parentfield": "transforms",
    "parenttype": "Insights Query",
    "type": ""
   }
  ],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.164,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"left\": {\n       \"arguments\": [\n        {\n         \"left\": {\n          \"type\": \"Column\",\n          \"value\": {\n           \"column\": \"lead_source\",\n           \"table\": \"tabCustomer\"\n          }\n         },\n         \"operator\": \"=\",\n         \"right\": {\n          \"type\": \"String\",\n          \"value\": \"Customer Referral\"\n         },\n         \"type\": \"BinaryExpression\"\n        }\n       ],\n       \"function\": \"count_if\",\n       \"type\": \"CallExpression\"\n      },\n      \"operator\": \"/\",\n      \"right\": {\n       \"arguments\": [\n        {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"name\",\n          \"table\": \"tabCustomer\"\n         }\n        }\n       ],\n       \"function\": \"count\",\n       \"type\": \"CallExpression\"\n      },\n      \"type\": \"BinaryExpression\"\n     },\n     \"operator\": \"*\",\n     \"right\": {\n      \"type\": \"Number\",\n      \"value\": 100\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"count_if(`tabCustomer.lead_source` = 'Customer Referral')/count(`tabCustomer.name`)*100\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-27 08:10:57.424460",
  "limit": 500,
  "modified": "2024-05-22 16:36:30.616072",
  "name": "QRY-0015",
  "result_name": "ct9qqjh516",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT (sum(CASE WHEN (`tabCustomer`.lead_source = 'Customer Referral') THEN 1 ELSE 0 END) / count(*)) * 100 AS `Referral Rate`\n  FROM `tabCustomer` AS `tabCustomer`\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer Referral Rate\u00a0 \u00a0",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.208,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:51:39.712550",
  "limit": 500,
  "modified": "2024-08-20 11:38:56.636684",
  "name": "QRY-0044",
  "result_name": "ct9qss1og3",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.541,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-27 08:10:56.532955",
  "limit": 500,
  "modified": "2024-05-24 09:45:21.737469",
  "name": "QRY-0004",
  "result_name": "ct9q95sd20",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Type of Customer Visual Query",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.193,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-23 13:51:44.207762",
  "limit": 500,
  "modified": "2024-06-10 15:42:29.388064",
  "name": "QRY-0029",
  "result_name": "ct9qu29ec0",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT common_customers AS `Customer Who Bought This Month & Last Month`,\n       customers_last_month_only AS `Customer Who Bought Last Month`,\n       CONCAT(ROUND(common_customers / customers_last_month_only * 100, 2), '%') AS `Retention Rate (%)`\n  FROM (\n        SELECT (\n                SELECT COUNT(DISTINCT customer)\n                  FROM `tabSales Invoice`\n                 WHERE YEAR(posting_date) = YEAR(CURRENT_DATE)\n                   AND MONTH(posting_date) = MONTH(CURRENT_DATE)\n                   AND customer IN (\n                        SELECT DISTINCT customer\n                          FROM `tabSales Invoice`\n                         WHERE YEAR(posting_date) = YEAR(CURRENT_DATE - INTERVAL 1 MONTH)\n                           AND MONTH(posting_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH)\n                       )\n               ) AS common_customers,\n               (\n                SELECT COUNT(DISTINCT customer)\n                  FROM `tabSales Invoice`\n                 WHERE YEAR(posting_date) = YEAR(CURRENT_DATE - INTERVAL 1 MONTH)\n                   AND MONTH(posting_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH)\n               ) AS customers_last_month_only\n       ) AS subquery",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate SQL Query",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.104,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKU\",\n   \"column\": \"item_code\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKU\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:51:40.729379",
  "limit": 500,
  "modified": "2024-08-21 14:01:22.279232",
  "name": "QRY-0046",
  "result_name": "ct9qsm2njl",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.posa_referral_company AS `Franchise`,\n       `tabSales Invoice Item`.item_code AS `SKU`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n GROUP BY `tabCustomer`.posa_referral_company,\n          `tabSales Invoice Item`.item_code,\n          `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise SKU Type of Customer WIse Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.2,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKU\",\n   \"column\": \"item_code\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKU\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:51:40.329628",
  "limit": 500,
  "modified": "2024-08-20 11:18:19.089259",
  "name": "QRY-0045",
  "result_name": "ct9qtsn6ri",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice Item`.item_code AS `SKU`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n GROUP BY `tabSales Invoice Item`.item_code,\n          `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Average # of refill SKUs per Customer Type\u00a0",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.153,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Item Code\",\n   \"column\": \"item_code\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Code\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Weekly\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Weekly\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:51:35.311293",
  "limit": 500,
  "modified": "2024-08-21 13:58:08.528821",
  "name": "QRY-0053",
  "result_name": "ct9rvq4vbu",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.posa_referral_company AS `Franchise`,\n       `tabSales Invoice Item`.item_code AS `Item Code`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Weekly`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n GROUP BY `tabCustomer`.posa_referral_company,\n          `tabSales Invoice Item`.item_code,\n          `tabCustomer`.type_of_customer,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise SKU Type of Customer WIse Refill Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 91.925,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Name\",\n   \"column\": \"customer_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Account Manager\",\n   \"column\": \"account_manager\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Account Manager\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Average Purchase Time\",\n   \"column\": \"average_purchase_time\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Average Purchase Time\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Type\",\n   \"column\": \"customer_type\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Type\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Creation\",\n   \"column\": \"creation\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Creation\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Credit Status\",\n   \"column\": \"credit_status\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Credit Status\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Default Commission Rate\",\n   \"column\": \"default_commission_rate\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Default Commission Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Customer Group\",\n   \"column\": \"customer_group\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Group\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Address Description\",\n   \"column\": \"address_description\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Address Description\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Text\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Default Price List\",\n   \"column\": \"default_price_list\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Default Price List\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Default Sales Partner\",\n   \"column\": \"default_sales_partner\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Default Sales Partner\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Disabled\",\n   \"column\": \"disabled\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Disabled\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Email Id\",\n   \"column\": \"email_id\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Email Id\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"First Purchase Date\",\n   \"column\": \"first_purchase_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"First Purchase Date\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Gender\",\n   \"column\": \"gender\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Gender\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Gps Location\",\n   \"column\": \"gps_location\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Gps Location\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Long Text\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Purchase Date\",\n   \"column\": \"last_purchase_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Last Purchase Date\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Name\",\n   \"column\": \"lead_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Source\",\n   \"column\": \"lead_source\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Source\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Territory\",\n   \"column\": \"territory\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Territory\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Loyalty Program\",\n   \"column\": \"loyalty_program\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Loyalty Program\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Loyalty Program Tier\",\n   \"column\": \"loyalty_program_tier\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Loyalty Program Tier\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Market Segment\",\n   \"column\": \"market_segment\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Market Segment\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Mobile No\",\n   \"column\": \"mobile_no\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Mobile No\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Modified\",\n   \"column\": \"modified\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Modified\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Next Projected Purchase Date\",\n   \"column\": \"next_projected_purchase_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Next Projected Purchase Date\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Date\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Outstanding Amount\",\n   \"column\": \"outstanding_amount\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Outstanding Amount\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Owner\",\n   \"column\": \"owner\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Owner\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Pending Bottles\",\n   \"column\": \"pending_bottles\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Pending Bottles\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Pending Bottles Count\",\n   \"column\": \"pending_bottles_count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Pending Bottles Count\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Posa Discount\",\n   \"column\": \"posa_discount\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Posa Discount\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Primary Address\",\n   \"column\": \"primary_address\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Primary Address\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Text\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 1000000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-23 11:29:35.222555",
  "limit": 500,
  "modified": "2024-08-21 12:49:37.005295",
  "name": "QRY-0018",
  "result_name": "ct9r94179s",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.customer_name AS `Customer Name`,\n       `tabCustomer`.account_manager AS `Account Manager`,\n       `tabCustomer`.average_purchase_time AS `Average Purchase Time`,\n       `tabCustomer`.customer_type AS `Customer Type`,\n       date_format(`tabCustomer`.creation, '%%Y-%%m-01') AS `Creation`,\n       `tabCustomer`.credit_status AS `Credit Status`,\n       `tabCustomer`.customer_group AS `Customer Group`,\n       `tabCustomer`.address_description AS `Address Description`,\n       `tabCustomer`.posa_referral_company AS `Referral Company`,\n       `tabCustomer`.default_price_list AS `Default Price List`,\n       `tabCustomer`.default_sales_partner AS `Default Sales Partner`,\n       `tabCustomer`.email_id AS `Email Id`,\n       date_format(`tabCustomer`.first_purchase_date, '%%Y-%%m-01') AS `First Purchase Date`,\n       `tabCustomer`.gender AS `Gender`,\n       `tabCustomer`.gps_location AS `Gps Location`,\n       date_format(`tabCustomer`.last_purchase_date, '%%Y-%%m-01') AS `Last Purchase Date`,\n       `tabCustomer`.lead_name AS `Lead Name`,\n       `tabCustomer`.lead_source AS `Lead Source`,\n       `tabCustomer`.territory AS `Territory`,\n       `tabCustomer`.loyalty_program AS `Loyalty Program`,\n       `tabCustomer`.loyalty_program_tier AS `Loyalty Program Tier`,\n       `tabCustomer`.market_segment AS `Market Segment`,\n       `tabCustomer`.mobile_no AS `Mobile No`,\n       date_format(`tabCustomer`.modified, '%%Y-%%m-01') AS `Modified`,\n       date_format(`tabCustomer`.next_projected_purchase_date, '%%Y-%%m-01') AS `Next Projected Purchase Date`,\n       `tabCustomer`.owner AS `Owner`,\n       `tabCustomer`.pending_bottles AS `Pending Bottles`,\n       `tabCustomer`.primary_address AS `Primary Address`,\n       sum(`tabCustomer`.default_commission_rate) AS `Default Commission Rate`,\n       sum(`tabCustomer`.disabled) AS `Disabled`,\n       sum(`tabCustomer`.outstanding_amount) AS `Outstanding Amount`,\n       sum(`tabCustomer`.pending_bottles_count) AS `Pending Bottles Count`,\n       sum(`tabCustomer`.posa_discount) AS `Posa Discount`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.customer_name,\n          `tabCustomer`.account_manager,\n          `tabCustomer`.average_purchase_time,\n          `tabCustomer`.customer_type,\n          date_format(`tabCustomer`.creation, '%%Y-%%m-01'),\n          `tabCustomer`.credit_status,\n          `tabCustomer`.customer_group,\n          `tabCustomer`.address_description,\n          `tabCustomer`.posa_referral_company,\n          `tabCustomer`.default_price_list,\n          `tabCustomer`.default_sales_partner,\n          `tabCustomer`.email_id,\n          date_format(`tabCustomer`.first_purchase_date, '%%Y-%%m-01'),\n          `tabCustomer`.gender,\n          `tabCustomer`.gps_location,\n          date_format(`tabCustomer`.last_purchase_date, '%%Y-%%m-01'),\n          `tabCustomer`.lead_name,\n          `tabCustomer`.lead_source,\n          `tabCustomer`.territory,\n          `tabCustomer`.loyalty_program,\n          `tabCustomer`.loyalty_program_tier,\n          `tabCustomer`.market_segment,\n          `tabCustomer`.mobile_no,\n          date_format(`tabCustomer`.modified, '%%Y-%%m-01'),\n          date_format(`tabCustomer`.next_projected_purchase_date, '%%Y-%%m-01'),\n          `tabCustomer`.owner,\n          `tabCustomer`.pending_bottles,\n          `tabCustomer`.primary_address\n LIMIT 1000000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer Data",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.168,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKU\",\n   \"column\": \"item_code\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKU\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate (%)\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Weekly\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Weekly\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:51:35.291242",
  "limit": 500,
  "modified": "2024-08-20 10:37:15.090577",
  "name": "QRY-0051",
  "result_name": "ct9r92v6f4",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice Item`.item_code AS `SKU`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Weekly`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate (%%)`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n GROUP BY `tabSales Invoice Item`.item_code,\n          `tabCustomer`.type_of_customer,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 100000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Average # of refill SKUs per Customer Type\u00a0 Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.516,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-23 11:24:31.219287",
  "limit": 500,
  "modified": "2024-06-14 13:09:38.111978",
  "name": "QRY-0057",
  "result_name": "ct9rhh3nqm",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT tc.type_of_customer AS \"Type of Customer\",\n       COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) AS \"Customers Who Bought These Two Week & Last Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Two Week Only\",\n       CONCAT(ROUND((COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0)) * 100, 2), '%') AS \"Retention Rate\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\"\n  FROM (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n  LEFT JOIN (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON lw.customer = tw.customer\n  LEFT JOIN `tabCustomer` tc\n    ON lw.customer = tc.name\n GROUP BY tc.type_of_customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate weekly with Type of Customer",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.49,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-23 11:24:31.175924",
  "limit": 500,
  "modified": "2024-06-14 13:08:46.823572",
  "name": "QRY-0056",
  "result_name": "ct9r5cq1dr",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) AS \"Customers Who Bought These Two Week & Last Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Two Week Only\",\n       CONCAT(ROUND((COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0)) * 100, 2), '%') AS \"Retention Rate\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\"\n  FROM (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n  LEFT JOIN (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON lw.customer = tw.customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.212,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Weekly\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Weekly\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:51:35.280677",
  "limit": 500,
  "modified": "2024-08-21 13:57:16.287876",
  "name": "QRY-0052",
  "result_name": "ct9r0vrfgg",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.posa_referral_company AS `Franchise`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Weekly`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n GROUP BY `tabCustomer`.posa_referral_company,\n          `tabCustomer`.type_of_customer,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Type of Customer WIse Refill Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.144,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:51:40.479528",
  "limit": 500,
  "modified": "2024-08-21 14:00:18.703573",
  "name": "QRY-0047",
  "result_name": "ct9rul0rmr",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.posa_referral_company AS `Franchise`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n GROUP BY `tabCustomer`.posa_referral_company,\n          `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Type of Customer WIse Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.373,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKU\",\n   \"column\": \"item_code\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKU\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Posting Date\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Posting Date\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Transactions Distinct\",\n   \"column\": \"name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Transactions Distinct\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customers\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Frequency\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"name\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"distinct_count(`tabSales Invoice.name`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Frequency\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-23 13:50:57.762718",
  "limit": 500,
  "modified": "2024-08-21 13:55:30.832393",
  "name": "QRY-0048",
  "result_name": "ct9rjm9v22",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.posa_referral_company AS `Franchise`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       `tabSales Invoice Item`.item_code AS `SKU`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Posting Date`,\n       count(DISTINCT `tabSales Invoice`.name) AS `Transactions Distinct`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customers`,\n       count(DISTINCT `tabSales Invoice`.name) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Frequency`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code LIKE '%%refill%%'\n GROUP BY `tabCustomer`.posa_referral_company,\n          `tabCustomer`.type_of_customer,\n          `tabSales Invoice Item`.item_code,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 10000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Refill Frequency Weekly",
  "transforms": [
   {
    "options": "{}",
    "parent": "QRY-0048",
    "parentfield": "transforms",
    "parenttype": "Insights Query",
    "type": ""
   }
  ],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.2,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-23 13:51:44.219731",
  "limit": 500,
  "modified": "2024-08-21 14:04:41.402212",
  "name": "QRY-0032",
  "result_name": "ct9ro7gvbe",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "WITH current_month_customers AS (\n        SELECT DISTINCT si.customer,\n               c.posa_referral_company\n          FROM `tabSales Invoice` si\n          JOIN `tabCustomer` c\n            ON si.customer = c.name\n         WHERE si.posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')\n           AND si.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01')\n       ),\n       previous_month_customers AS (\n        SELECT DISTINCT si.customer,\n               c.posa_referral_company\n          FROM `tabSales Invoice` si\n          JOIN `tabCustomer` c\n            ON si.customer = c.name\n         WHERE si.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01')\n           AND si.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')\n       ),\n       both_months_customers AS (\n        SELECT pmc.customer,\n               pmc.posa_referral_company\n          FROM previous_month_customers pmc\n          JOIN current_month_customers cmc\n            ON pmc.customer = cmc.customer\n       ),\n       franchises AS (\n        SELECT posa_referral_company\n          FROM `tabCustomer`\n         GROUP BY posa_referral_company\n       ) SELECT f.posa_referral_company AS 'Franchise',\n       COUNT(bmc.customer) AS 'Customer Who Bought This Month & Last Month',\n       COUNT(pmc.customer) AS 'Customer Who Bought Last Month',\n       CONCAT(FORMAT((COUNT(bmc.customer) * 100.0 / NULLIF(COUNT(pmc.customer), 0)), 2), '%') AS 'Retention Rate (%)'\n  FROM franchises f\n  LEFT JOIN previous_month_customers pmc\n    ON f.posa_referral_company = pmc.posa_referral_company\n  LEFT JOIN both_months_customers bmc\n    ON pmc.customer = bmc.customer\n GROUP BY f.posa_referral_company",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate SQL Query Franchise Wise\u00a0",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.535,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-23 11:24:31.192669",
  "limit": 500,
  "modified": "2024-08-21 14:05:41.056406",
  "name": "QRY-0035",
  "result_name": "ct9rj057ve",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT c.posa_referral_company AS \"Franchise\",\n       c.type_of_customer AS \"Type of Customer\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought This Week & Last Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Week Only\",\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT name,\n               type_of_customer,\n               posa_referral_company\n          FROM `tabCustomer`\n       ) AS c\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n    ON c.name = lw.customer\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON c.name = tw.customer\n GROUP BY c.posa_referral_company,\n          c.type_of_customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Weekly with Type Of Customer",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 1.019,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Item Code\",\n   \"column\": \"item_code\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Code\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Item Name Qty\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IF(item_code REGEXP '^[^0-9]', 1, IF(item_code REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code, ' ', 1) AS DECIMAL(10, 2)))) AS `Item Name Qty`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IF(item_code REGEXP '^[^0-9]', 1, IF(item_code REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code, ' ', 1) AS DECIMAL(10, 2)))) AS `Item Name Qty`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Name Qty\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Invoice Item Qty\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Invoice Item Qty\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Total Quantity\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IF(item_code REGEXP '^[^0-9]', 1, IF(item_code REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code, ' ', 1) AS DECIMAL(10, 2)))) * sum(`tabSales Invoice Item`.qty) AS `Total Quantity` \"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IF(item_code REGEXP '^[^0-9]', 1, IF(item_code REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code, ' ', 1) AS DECIMAL(10, 2)))) * sum(`tabSales Invoice Item`.qty) AS `Total Quantity` \\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Quantity\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-23 13:50:07.053891",
  "limit": 500,
  "modified": "2024-08-21 13:53:38.146014",
  "name": "QRY-0042",
  "result_name": "ct9r5mu4gf",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.posa_referral_company AS `Referral Company`,\n       `tabSales Invoice Item`.item_code AS `Item Code`,\n       IF(item_code REGEXP '^[^0-9]', 1, IF(item_code REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code, ' ', 1) AS DECIMAL(10, 2)))) AS `Item Name Qty`,\n       sum(`tabSales Invoice Item`.qty) AS `Invoice Item Qty`,\n       IF(item_code REGEXP '^[^0-9]', 1, IF(item_code REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code, ' ', 1) AS DECIMAL(10, 2)))) * sum(`tabSales Invoice Item`.qty) AS `Total Quantity`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n GROUP BY `tabCustomer`.posa_referral_company,\n          `tabSales Invoice Item`.item_code\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Product Sale Per Franchise",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.579,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-23 11:24:31.152430",
  "limit": 500,
  "modified": "2024-08-21 14:05:13.246172",
  "name": "QRY-0055",
  "result_name": "ct9r6l8vjh",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT c.posa_referral_company AS \"Franchise\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought These Two Week & Last Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Two Week Only\",\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT name,\n               posa_referral_company\n          FROM `tabCustomer`\n       ) AS c\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n    ON c.name = lw.customer\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON c.name = tw.customer\n GROUP BY c.posa_referral_company",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Wise Retention Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.624,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise Country\",\n   \"column\": \"territory\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Country\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-27 09:27:50.181371",
  "limit": 500,
  "modified": "2024-08-21 14:02:50.297850",
  "name": "QRY-0064",
  "result_name": "csnu7abp57",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.territory AS `Franchise Country`,\n       `tabCustomer`.posa_referral_company AS `Referral Company`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.territory,\n          `tabCustomer`.posa_referral_company\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Visual Query dynamic Franchise Wise(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.789,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise Country\",\n   \"column\": \"territory\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Country\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"posa_referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-27 09:27:50.156615",
  "limit": 500,
  "modified": "2024-08-21 14:03:28.553443",
  "name": "QRY-0070",
  "result_name": "csntn54rmp",
  "results_row_count": 4,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.territory AS `Franchise Country`,\n       `tabCustomer`.posa_referral_company AS `Referral Company`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.territory,\n          `tabCustomer`.posa_referral_company,\n          `tabCustomer`.type_of_customer\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Visual Query dynamic Franchise Wise Type Of Customer(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.353,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Previous Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-27 09:27:51.547665",
  "limit": 500,
  "modified": "2024-08-27 08:11:08.087043",
  "name": "QRY-0068",
  "result_name": "csobk966j2",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Visual Query dynamic Franchise Wise(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.455,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Previous Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-27 09:27:51.363960",
  "limit": 500,
  "modified": "2024-08-16 15:18:54.588058",
  "name": "QRY-0069",
  "result_name": "cso8o5svuh",
  "results_row_count": 4,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.type_of_customer\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Visual Query dynamic Franchise Wise Type Of Customer wise (Weekly)",
  "transforms": [],
  "variables": []
 }
]